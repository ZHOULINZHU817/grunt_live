/*frame by Ella Liu*/
FM.plugin.pwd=function(a){var e=this;FM.helper.reqJs("/resource/js/plugin/sha256.js",function(){a=$.extend(!0,{em:$("#pay_pwd"),saltApi:"/api/srv/get_salt",base64Cert:"-----BEGIN CERTIFICATE-----\nMIICCzCCAXQCCQDS3bwzUSZwWTANBgkqhkiG9w0BAQUFADBJMQswCQYDVQQGEwJBVTETMBEGA1UEChMKV0VJSFVJLkNPTTElMCMGA1UECxMcV0VJSFVJIFRlbXBvcmFyeSBDZXJ0aWZpY2F0ZTAgFw0xMjA5MjkwMDUzNDJaGA8yMTEyMDkwNTAwNTM0MlowSTELMAkGA1UEBhMCQVUxEzARBgNVBAoTCldFSUhVSS5DT00xJTAjBgNVBAsTHFdFSUhVSSBUZW1wb3JhcnkgQ2VydGlmaWNhdGUwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAOInRLmoDJp1whLf3jvuaFGyB7OlmS5u4LmDX5rattEpLQ9uvUeEBPw8++ldD2Z6d5RNe7s5Y4RsaIn+FgjF+tSy3yIkpiZxxzXJMtIwzSbtXRgpa5fo0w0l/LgdHnMSTJzWncOGTrzmuuzAVtwa9NV89MzcsPoFOxftnVucud2xAgMBAAEwDQYJKoZIhvcNAQEFBQADgYEAvLtaFZb49HOKToh9/562CZlCZz9QNl3OQh+EmFP3tvuTsF0/0vRTM5fkfVXMilBBLiDiCchpY063iinV5oDgMjWQ4MfOj5jt2GUXiwsRXMM1Grb4NzSiMrwOEHoB3tm1W7Or/ffvcGF76WyE7fBg9s1sYT9xU/6gbkt0IyDuwj0=\n-----END CERTIFICATE-----",pubkey:!1},a);var n=function(a){for(var e="",n=0;n<a.length;n++)e+=a.charCodeAt(n).toString(16);return e};this._init=function(){e.encrypt=function(e,t){FM.helper.ajx({api:a.saltApi,type:"GET",success:function(p){FM.helper.ajax_success(p,function(s){if(s.salt){var r=s.salt,i=[];a.em.filter("[data-encrypt=rsa]").length&&i.push("/resource/js/plugin/rsa.js"),a.em.filter("[data-encrypt=aes]").length&&i.push("/resource/js/plugin/aes.js"),FM.helper.reqJs(i,function(){function t(a){var e=FM.plugin.sha256(FM.plugin.sha256(a.val())+r);0==$(".payPwd").length?(a.parents("form").prepend('<input class="payPwd" type="hidden" name="'+a.attr("name")+'">'),$(".payPwd").val(e)):$(".payPwd").val(e)}function p(a){var e=FM.plugin.aes.encrypt(n(r),FM.plugin.sha256(a.val()));0==$(".payPwd").length?(a.parents("form").prepend('<input class="payPwd" type="hidden" name="'+a.attr("name")+'">'),$(".payPwd").val(e)):$(".payPwd").val(e)}function s(e){a.component.pubkey=a.component.pubkey||FM.plugin.rsa.readCertPEM(a.component.base64Cert),FM.plugin.rsa.setMaxDigits(Math.floor(a.component.pubkey[0].length/2)+3);var n=new FM.plugin.rsa.RSAKeyPair(a.component.pubkey[1],"",a.component.pubkey[0]),t=FM.plugin.rsa.encryptedString(n,FM.plugin.sha256(e.val())+r);0==$(".payPwd").length?(e.parents("form").prepend('<input class="payPwd" type="hidden" name="'+e.attr("name")+'">'),$(".payPwd").val(t)):$(".payPwd").val(t)}a.em.each(function(){var a=$(this);switch(a.data("cache_val",a.val()),$(this).attr("data-encrypt")){case"rsa":s(a);break;case"aes":p(a);break;case"sha":default:t(a)}e()})})}else t(p,"system error","salt can not get")})},error:function(a,e,n){t(a,e,n)}})}},this.get_conf=function(){return a},this._init()})};