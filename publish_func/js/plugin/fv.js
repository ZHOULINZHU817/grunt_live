/*frame by Ella Liu*/
!function(){var e={empty:{exp:/[^\s]/,err:"请填写%s"},number:{exp:/^[0-9]+$/,err:"%s只能输入数字"},integer:{exp:/^[0-9]+$/,err:"%s只能输入整数"},decimal:{exp:/^[0-9]+(\.[0-9]+)?$/,err:"%s只能输入整数或小数"},chinese:{exp:/^[\u2E80-\uFE4F]+$/,err:"%s只能输入汉字"},name:{exp:/^([\u4e00-\u9fa5|A-Z]+\s*\.?\s*)+$/,err:"%s只能由中文汉字或大写英文字母构成"},chinese_ch:{exp:/^[\u2E80-\uFE4F]{2,6}$/,err:"%s只能输入2-6位中文字"},chinese_name:{exp:/^[\u4E00-\u9FA5]{2,5}(?:·[\u4E00-\u9FA5]{2,5})*$/,err:"%s只能输入中文姓名"},consignee:{exp:/^[a-zA-Z\u4E00-\u9FA5]+$/i,err:"%s只能由中文汉字或英文字母构成"},address:{exp:/^[0-9a-zA-Z\-\u4E00-\u9FA5]+$/i,err:"%s只能由中文汉字、英文字母或者数字构成"},captcha:{exp:/^\w{4}$/,err:"%s只能由4位英文字母或者数字构成"},truename:{exp:/^[^\*]{2,50}$/,err:"%s输入错误，请重新输入"},id:{exp:/^\d{14}[0-9a-zA-Z]$|^\d{17}[0-9a-zA-Z]$/,err:"身份证号码输入错误，请重新输入"},passport:{exp:/^[A-Za-z]\d{7,8}$/,err:"护照号码输入错误，请重新输入"},email:{exp:/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,err:"邮箱格式错误"},miemail:{exp:/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2,5})?)$/,err:"邮箱格式错误"},mobile:{exp:/^1\d{10}$/,err:"你输入的是一个无效手机号"},r_mobile:{exp:/^1\d{10}$/,err:"请填写11位手机号码"},t_mobile_e:{exp:/[^\s]/,err:"手机号未填写"},t_mobile:{exp:/^1\d{10}$/,err:"请填写11位手机号码"},bank_card:{exp:/^[0-9\-]{8,32}$/,err:"请输入正确的%s"},CVV:{exp:/^\d{3,4}$/,err:"%s只能是3或4位数字"},vcode:{exp:/^\w{6}$/,err:"%s有误，请重新输入"},pvcode:{exp:/^\w{4,8}$/,err:"%s有误，请重新输入"},sms_vcode:{exp:/^\w{6}$/,err:"%s有误，请重新输入"},validDate:{exp:/^\d{4,10}$/,err:"%s只能是4~10位数字"},amount:{exp:/^(([1-9][0-9]*)|0)\.[0-9]{1,2}$|^[1-9][0-9]*$/,err:"%s只能是整数或2位以内小数"},amount_integer:{exp:/^[0-9]+$/,err:"%s只能输入整数"},amount_hundred:{exp:/^[1-9]\d*00$/,err:"%s只能是100的倍数"},amount_thousand:{exp:/^[1-9]\d*000$/,err:"%s只能是1000的倍数"},wbAccount:{exp:/^1\d{10}$|^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,err:"%s必须是手机号或邮箱地址"},password:{exp:/^\S{8,16}$/,err:"%s长度只能是8~16位"},paypassword:{exp:/^.{8,16}$/,err:"%s长度只能是8~16位"},v_paypassword:{exp:/^.{1,50}$/,err:"%s长度必须小于50位"},wbPassword:{exp:/[^\s]/,err:"请输入微博登录密码"},zip:{exp:/^\d{6}$|^[\s]$/,err:"请正确的邮政编码"}},a={len:"%s1长度为%s2位",minlen:"%s1长度不能小于%s2位",maxlen:"%s1长度不能超过%s2位",minval:"%s1不能小于%s2",maxval:"%s1不能大于%s2",paybalance:" "};FM.plugin.fv=function(t,r,n){function i(r,i){var s=i||t.find("input[data-vfield]:visible:enabled,select[data-vfield]:enabled,input[type=hidden][data-vfield],input[type=checkbox][data-vfield]:visible,textarea[data-vfield]"),u={result:!0,ary:[]};return t.find(".input_hint").hide(),$.each(s,function(t,i){var s=$(this);s.val($.trim(s.val()));var o,c,l,p,d=!0,f="",h=s.attr("data-vfield"),v=s.val(),m=s.attr("id");if(n[m]&&"function"==typeof n[m].forcepass&&n[m].forcepass(v));else{if(o=n[m].rules,c=n[m].empty_ignore||!1,l=n[m].same_as,p=n[m].etext_same_as,"SELECT"==s[0].tagName&&("selectplease"===v||!v)&&(v=""),"checkbox"===s.attr("type"))s.is(":checked")||(d=!1,f=s.attr("data-vfield"));else{o=o.split(" ");for(var _=0;_<o.length;_++){if(-1!==o[_].indexOf("amount")){for(var b=s.val();"0"===b[0]&&"."!==b[1];)b=b.slice(1);s.val(b),v=b}if("empty"===o[_]&&c===s.val()){d=!1;break}if("same_as"===o[_]&&$(l).val()!=s.val()){d=!1,f=p;break}if(e[o[_]]&&!e[o[_]].exp.test(v)){d=!1,f=(k=n[m]["etext_"+o[_]]||e[o[_]].err).replace(/%s/g,h);break}if("integer_multiples"===o[_]&&v%(g=parseInt(n[m][o[_]]))!=0){d=!1,f="请输入"+g+"的整数倍";break}if(a[o[_]]){var x=!0,g=n[m][o[_]],y=parseInt(g,10),w=parseFloat(g,10);switch(o[_]){case"len":x=v.length==y;break;case"minlen":x=v.length>=y;break;case"maxlen":x=v.length<=y;break;case"minval":x=parseFloat(v,10)>=w;break;case"maxval":case"paybalance":x=parseFloat(v,10)<=w;break;default:x=!0}if(!x){var k=n[m]["etext_"+o[_]]||a[o[_]];d=!1,f=k.replace(/%s1/g,h).replace(/%s2/g,g);break}}if("v_paypassword"===o[_]&&(/[^\x00-\xff]/.test(v)||/\s+/.test(v))){d=!1,f="支付密码错误";break}if("m_paypassword"===o[_]){if(/[^\x00-\xff]/.test(v)||/\s+/.test(v)||!/^.{8,16}$/.test(v)){d=!1,f="支付密码必须由8-16位字母、数字或符号组成";break}for(var F=v.slice(0,1),A="",z=0;z<v.length;z++)A+=F;if(A===v){d=!1,f="支付密码不能设置相同的字母/数字/符号";break}if(/^[0-9]+$/.test(v)){var M="",Z="";F=parseInt(F,10);for(z=0;z<v.length;z++)M+=F+z,Z+=F-z;if(M===v||Z===v){d=!1,f="支付密码不能设置连续的数字";break}}}if(-1!==o[_].indexOf("amount")&&0===parseFloat(v,10)){d=!1,f="金额必须大于0";break}}}d||(u.result=!1,u.ary.push({em:s,key:s.attr("data-vfield"),err:f}),"function"==typeof r&&r(s,f))}}),u}function s(e){if(!/^(0|[1-9]\d*)(\.\d+)?$/.test(e))return"";var a="千百拾亿千百拾万千百拾元角分",t="",r=(e+="00").indexOf(".");r>=0&&(e=e.substring(0,r)+e.substr(r+1,2)),a=a.substr(a.length-e.length);for(var n=0;n<e.length;n++)t+="零壹贰叁肆伍陆柒捌玖".charAt(e.charAt(n))+a.charAt(n);return t.replace(/零(千|百|拾|角)/g,"零").replace(/(零)+/g,"零").replace(/零(万|亿|元)/g,"$1").replace(/(亿)万|壹(拾)/g,"$1$2").replace(/^元零?|零分/g,"").replace(/元$/g,"元整")}function u(){setTimeout(function(){t.find("[data-chinese]").each(function(e){var a=$(this).data("val_cached")||"";a!==$(this).val()&&(a=$(this).val(),$(this).data("val_cached",a),$($(this).attr("data-chinese")).html(s(a)))}),u()},100)}var o=this;!function(e){var a={show_v_error:function(e,a){},_init_even:function(e){},returnbeforesubmit:function(){return!0},start:function(){},end:function(){},success:function(e){console.log(e)},privatehandle:function(){},error:function(e){console.log(e)},_error:function(e,a,t){FM.helper.ajax_error(e,a,t)},no_ajax:!1,just_verify:!1,unit:""};$.extend(a,e),a._init_even(a.show_v_error);var r=!1,n=t.find("input[data-encrypt]:visible");n.length&&FM.helper.reqJs("/resource/js/plugin/pwd.js",function(){r=new FM.plugin.pwd({em:n,saltApi:"/api/srv/get_salt"})});var s=!1,u=t.find("input[data-encrypt-key]:visible");u.length&&FM.helper.reqJs("/resource/js/plugin/pwd_key.js",function(){s=new FM.plugin.pwd_key({em:u,salt_url:"/api/srv/get_salt"})}),t.unbind("submit").submit(function(e){function o(e){a.start(),FM.UI.loading(!0);var r={};$.each(t.serializeArray(),function(e,a){""===$.trim(a.value)?t.find("[name="+a.name+"]:visible").length&&(r[a.name]=a.value):r[a.name]=a.value}),r._rd=Math.random(),FM.helper.ajx({api:t.find('input[name="operationType"]').val(),type:t.attr("method"),success:function(r){t.removeData("submitting"),FM.UI.loading(!1),FM.helper.ajax_success(r,function(t){FM.UI.loading(!0),"function"==typeof e&&e(),a.end(),a.success(t)},function(t){"function"==typeof e&&e(),"414"!==t.head.code&&FM.UI.alert(t.head.msg),a.end(),a.error(t)})},error:function(r,n,i){t.removeData("submitting"),"function"==typeof e&&e(),a.end(),a._error(r,n,i)}},r)}function c(e,a){a?e.each(function(){$(this).attr("name",$(this).attr("data-name")).removeAttr("data-name"),"yes"===$(this).data("data-keep")&&$(this).data("cache_val")&&$(this).val($(this).data("cache_val")).removeData("cache_val")}):e.each(function(){var e=$(this).attr("name");t.find("input[type=hidden][name="+e+"]").remove().end().prepend('<input name="'+e+'" type="hidden" />').find("input[type=hidden][name="+e+"]").val($(this).val()),$(this).attr("data-name",$(this).attr("name")).removeAttr("name").val("")})}var l=t.find("[type=submit]")||t.find("button:first")||t.find("[type=button]:first");if(l.hasClass("disabled"))return!1;var p=i(a.show_v_error);return p.result?!!a.returnbeforesubmit()&&(a.no_ajax?(a.start(),FM.UI.submiter_block(l,!0),!0):"yes"!=t.data("submitting")&&(t.data("submitting","yes"),r||s?r?r.encrypt(function(){n.each(function(){$(this).attr("name"),$(this).attr("data-name",$(this).attr("name")).removeAttr("name")}),o(function(){n.each(function(){$(this).attr("name",$(this).attr("data-name")).removeAttr("data-name"),"yes"===$(this).data("data-keep")&&$(this).data("cache_val")&&$(this).val($(this).data("cache_val")).removeData("cache_val")})})},function(e,r,n){t.removeData("submitting"),FM.UI.submiter_block(l,!1),FM.UI.alert({msg:"获取加密salt失败"}),a.error(e,r,n)}):s.pre_submit(function(){c(u,!1),o(function(){c(u,!0)})}):o(),e.preventDefault(),!1)):(a.end(),FM.UI.alert(p.ary[0].err+a.unit),!1)}),a.just_verify&&t.unbind("submit").submit(function(){return i(a.show_v_error).result?a.start():a.end(),!1}),o.v_it=function(){return i(a.show_v_error)}}(r),t.find(".amount_fix").on("keydown",function(e){var a={8:!0,46:!0,18:!0,37:!0,35:!0,36:!0,39:!0,116:!0,110:!0,190:!0};if(!(47<e.which&&e.which<58||95<e.which&&e.which<106||a[e.which]))return e.preventDefault(),!1}).on("keyup",function(){var e=$(this),a=e.val(),t=a.replace(/[^0-9\.]/g,"");a!==t&&e.val(t)}),t.find("[data-chinese]").length&&u()}}();